<header class="mb-4">

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <p><i class="fish1 fas fa-fish fa-2x"></i><a class="title navbar-brand" href="/">大阪釣りスポット</a><i class="fish2 fas fa-fish fa-2x fa-rotate-180"></i></p>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
      <ul class="navbar-nav">
        
        <% if logged_in? %>
        
          <!--釣り場検索機能-->
          <li class="nav-item dropdown">
            <%= form_with url: spot_search_path, id: "search",  method: :get, local: true do |f| %>
              <%= f.text_field :name, class: 'form-control search_form', placeholder: "釣り場を入力しよう!" %>
              <%= f.submit :検索, class: "btn btn-success", id: "sbtn" %>
            <% end %>
          </li>
        
          <!--釣り場のお気に入りランキング機能-->
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">お気に入りランキング<i class="fas fa-crown"></i></a>
            <ul class="ranking dropdown-menu dropdown-menu-right">
              <!--前のいいね数を一時的に保存できる変数lastFavoriteを作成-->
              <% lastFavorite = 0 %>
              <% j = 1 %>
              <% @all_ranks.each.with_index(1) do |spot, i| %>
                <% if i == 1 %>
                  <% lastFavorite = spot.favorites.count %>
                <% end %>
                <!--前のお気に入り数と今のお気に入り数が違うなら変数jにiの値を代入-->
                <% if spot.favorites.count != lastFavorite %>
                  <% j = i %>
                  第<strong><%= j %></strong>位
                  <%= link_to spot.name, spot_path(spot) %>
                  <br>
                  お気に入り数：<span class="badge badge-secondary"><%=spot.favorites.count %></span>
                  <% lastFavorite = spot.favorites.count %>
                <% else %>
                  <!--次のお気に入り数と比べるため前のお気に入り数に今のいいね数を代入-->
                  <% lastFavorite = spot.favorites.count %>
                  第<strong><%= j %></strong>位
                  <%= link_to spot.name, spot_path(spot) %>
                  <br>
                  お気に入り数：<span class="badge badge-secondary"><%=spot.favorites.count %></span>
                <% end %>
              <br>
             <% end %>
            </ul>
          </li>
          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown"><%= current_user.name %></a>
            <ul class="dropdown-menu dropdown-menu-right">
              <li class="dropdown-item"><%= link_to 'マイプロフィール', user_path(current_user) %></li>
              <li class="dropdown-item"><%= link_to 'ログアウト', logout_path, method: :delete %></li>
            </ul>
          </li>
          
        <% else %>
          
          <li class="nav-item sign_up"><%= link_to '新規登録', signup_path, class: 'nav-link' %></li>
          <p class="fukidashi">釣り場検索、コメント投稿、お気に入り登録などができます。</p>
          <li class="nav-item"><%= link_to 'ログイン', login_path, class: 'nav-link' %></li>
          
        <% end %>
      </ul>
    </div>
  </nav>
</header>